#!/bin/bash
#
# dwg2txt - Convert DWG files to text format
# Uses dwg2text utility to extract text content from DWG files
#

set -e

# Get script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Function to show usage
usage() {
    cat << EOF
Usage: $0 <input.dwg> <output.txt>

Convert DWG file to text format by extracting text entities.

Arguments:
  input.dwg   Input DWG file path
  output.txt  Output text file path

Example:
  $0 drawing.dwg output.txt

EOF
    exit 1
}

# Check arguments
if [ $# -ne 2 ]; then
    echo "Error: Invalid number of arguments"
    usage
fi

INPUT_FILE="$1"
OUTPUT_FILE="$2"

# Check if input file exists
if [ ! -f "$INPUT_FILE" ]; then
    echo "Error: Input file does not exist: $INPUT_FILE"
    exit 1
fi

# Check if dwg2text exists
DWG2TEXT="${SCRIPT_DIR}/dwg2text"
if [ ! -x "$DWG2TEXT" ]; then
    echo "Error: dwg2text utility not found or not executable: $DWG2TEXT"
    exit 1
fi

# Convert DWG to text
if "$DWG2TEXT" "$INPUT_FILE" > "$OUTPUT_FILE" 2>&1; then
    echo "✓ Successfully converted: $OUTPUT_FILE"
    exit 0
else
    echo "⚠ Warning: dwg2text failed, creating empty output file"
    echo "" > "$OUTPUT_FILE"
    exit 1
fi
