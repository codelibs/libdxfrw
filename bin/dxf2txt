#!/bin/bash
#
# dxf2txt - Convert DXF files to text format
# Uses Python script to extract text content from DXF files
#

set -e

# Get script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Function to show usage
usage() {
    cat << EOF
Usage: $0 <input.dxf> <output.txt>

Convert DXF file to text format by extracting text entities.

Arguments:
  input.dxf   Input DXF file path
  output.txt  Output text file path

Example:
  $0 drawing.dxf output.txt

Requirements:
  - Python 3
  - ezdxf Python package (pip install ezdxf)

EOF
    exit 1
}

# Check arguments
if [ $# -ne 2 ]; then
    echo "Error: Invalid number of arguments"
    usage
fi

INPUT_FILE="$1"
OUTPUT_FILE="$2"

# Check if input file exists
if [ ! -f "$INPUT_FILE" ]; then
    echo "Error: Input file does not exist: $INPUT_FILE"
    exit 1
fi

# Find Python interpreter
PYTHON=""
for cmd in python3 python; do
    if command -v $cmd >/dev/null 2>&1; then
        PYTHON=$cmd
        break
    fi
done

if [ -z "$PYTHON" ]; then
    echo "Error: Python not found. Please install Python 3."
    exit 1
fi

# Check if ezdxf is available
if ! $PYTHON -c "import ezdxf" 2>/dev/null; then
    echo "Error: ezdxf package not found. Please install it:"
    echo "  pip install ezdxf"
    exit 1
fi

# Convert DXF to text
$PYTHON "${SCRIPT_DIR}/dxf2txt.py" "$INPUT_FILE" "$OUTPUT_FILE"

echo "âœ“ Successfully converted: $OUTPUT_FILE"

